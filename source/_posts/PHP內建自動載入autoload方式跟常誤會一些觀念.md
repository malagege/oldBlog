---
title: PHP內建自動載入autoload方式跟常誤會一些觀念
date: 2019-01-18 20:23:51
tags: [composer, autoload]
categories: PHP
---

最近有計畫學 Laravel
不過想趁機會把 PHP `Namespace`搞清楚
我在想`autoload`自動載入是甚麼機制的
最近小小的玩了一下，才知道這個`自動載入`是怎麼用的
其實我覺得也不是完全自動載入阿~~終究還是手動需做載入一段程式

<!--more-->

## PHP 原有 autoload 方式

include, include_once, require , require_once

都是載入功能。
比較特別注意 include 當載入失敗會跳出警告，但是不會停止程式
require 載入失敗會跳出錯誤，不會繼續執行下面程式

常常忘記哪個會載入錯誤 orz
順便記載這邊

## PHP Autoload

前面兩個是比較早期的自動載入方式。簡單來講就是自動載入`xxx.php`方法
後面 namespace 可搭配`composer`實作

- \_\_autoload
- spl_autoload
- autoload 與 namespace

[PHP 系列 - Autoload 自動載入 « Eric G. Huang 不像樣工程師](http://justericgg.logdown.com/posts/196891-php-series-autoload) {% asset_link web1.png 備份圖 %}
上面連結介紹太清楚了。
我這邊仔細記錄我實務的問題

## 常常搞錯的觀念

我是有學過 Java，所以對 Java Namespace 不是很陌生
但當初看 PHP 的 Namespace 有看沒有懂
學得他們很像，但又不是很像
但說 Java Namespace 定義很清楚
PHP 並沒有那麼清楚(畢竟是腳本語言....)

### 還是需要放置載入程式

首先來看看 Laravel 的 Controller.php

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Bus\DispatchesJobs;
use Illuminate\Routing\Controller as BaseController;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Foundation\Auth\Access\AuthorizesRequests;

class Controller extends BaseController
{
    use AuthorizesRequests, DispatchesJobs, ValidatesRequests;
}
```

~~看到這個我整個高潮了~~
其實我以為 PHP 已經完完整整可以自動載入
不過我自己實作卻是不能...
最終爬文還是找到答案

~~下面那篇 PO 文跟我一樣 HI XD~~
[php 的 use 明顯比 require 高端大氣上檔次 - 開源中國](https://www.oschina.net/question/123890_135938?sort=default&p=2)
[php 使用命名空间:导入导出之疑问 - 开源中国](https://www.oschina.net/question/147332_138188)

為什麼 Laravel 的 Controller.php 可以自動載入
關鍵還是 index.php 的`require __DIR__.'/../vendor/autoload.php';`
所以我才說也不是真正的自動載入
不過方法真的已經比以前好很多

## 發現我自己寫的 PHP 沒辦法 use 使用到

當以為你以為`require 'vendor/autoload.php';`可以載入所有 php 檔案內容
你可能就大錯特錯了!!!

composer.json 有一個 classmap 自動載入

```json
{
    ...
    "autoload": {
    	"classmap": {
    		"mylib"
    	}
    }
    ...
}
```

~~但不能設定`.`~~可以設定`.`
發現我寫錯了，應該要用陣列才對
上面能跑純屬意外

```json
{
    ...
    "autoload": {
    	"classmap": [
    		"."
    	]
    }
    ...
}
```

## 發現新增檔案跟修改 class 名稱沒有自動載入到

當我發現這件事，還以為我哪裡寫錯了
其實有看到這篇[php – composer.json 設定 classmap 指定自動讀取的檔案或路徑 | jsnWork](http://jsnwork.kiiuo.com/archives/2437/php-composer-json-%e8%a8%ad%e5%ae%9a-classmap-%e6%8c%87%e5%ae%9a%e8%87%aa%e5%8b%95%e8%ae%80%e5%8f%96%e7%9a%84%e6%aa%94%e6%a1%88%e6%88%96%e8%b7%af%e5%be%91/)
vendor/composer/autoload_classmap.php

```php
<?php

// autoload_classmap.php @generated by Composer

$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    'mylib\\Test' => $baseDir . '/mylib/test.php',
);

```

看到原來自動載入原來不是真的跑每一層資料夾
是透過暫存方式載入
之前一直還在想有什麼辦法看到目前會自動載入哪些
看來還是有辦法知道的

## PSR0 , PSR4

看了一下好像都是自動載入
PSR0 命名規則跟 JAVA 很像
但是 PSR4 規則也不一定要跟 JAVA 擺放位置一樣
我也沒看很詳細，有空再仔細吸收....
[psr-0 和 psr-4 的区别 - shuizhuniurou - SegmentFault 思否](https://segmentfault.com/a/1190000006686978)

## Namespace 一些事

Namespace 是不分大小寫的，跟 class、function 一樣沒有分
但是在 use 引用變數(ex:\$a)
想說 class 會不會跟 function 一樣不能共用一樣名字
但測試結果是可以的
我還滿驚呆

```php
<?php
        //Enter your code here, enjoy!

class A
{
    public function __toString() {
        return 'A';
    }
}

function a(){
    echo 'aa';
}

echo new A();
echo '========';
echo  A();
```

結果

```
A========aa
```

那同時去做 use A 不知道會
但用在 use 呢?!
經過小小實驗(未確任是否正確，自己得出的結論)
function 要用通常是要用
`use function xxxx`
但是做 classmap 跟 psr-4 都載入不到(不知道為什麼)
但有找到[Composer/PSR - How to autoload functions? - Stack Overflow](https://stackoverflow.com/questions/24171078/composer-psr-how-to-autoload-functions)
[深入 Composer autoload | Laravel China 社区 - 高品质的 Laravel 和 PHP 开发者社区](https://laravel-china.org/topics/1002/deep-composer-autoload)
要選`files`
不過沒有什麼事情還是不要用 function 吧 XD
這我就沒實作確認

感覺 composer,psr0,psr4 之後還是需要好好了解
先記錄到這邊

參考來源：

- [有人用过 PHP 的 use function 吗？ | Laravel China 社区 - 高品质的 Laravel 和 PHP 开发者社区](https://laravel-china.org/index.php/topics/6998/have-anyone-used-phps-use-function)
- [PHP 系列 - Autoload 自動載入 « Eric G. Huang 不像樣工程師](http://justericgg.logdown.com/posts/196891-php-series-autoload)
- [[PHP]require 和 include @ Jonas's Blog :: 痞客邦 ::](http://jonas1011.pixnet.net/blog/post/24303632-%5Bphp%5Drequire-%E5%92%8C-include)
- [PHP Sandbox, test PHP online, PHP tester](http://sandbox.onlinephpfunctions.com/)
- [Composer 進階原理：PHP 命名空間與 PSR-0 | 轉個彎日誌](http://blog.turn.tw/?p=1122) {% asset_link web2.png 備份圖 %}
- [Composer 設計原理與基本用法 | 轉個彎日誌](http://blog.turn.tw/?p=1039) {% asset_link web3.png 備份圖 %}
- [php – composer.json 設定 classmap 指定自動讀取的檔案或路徑 | jsnWork](http://jsnwork.kiiuo.com/archives/2437/php-composer-json-%E8%A8%AD%E5%AE%9A-classmap-%E6%8C%87%E5%AE%9A%E8%87%AA%E5%8B%95%E8%AE%80%E5%8F%96%E7%9A%84%E6%AA%94%E6%A1%88%E6%88%96%E8%B7%AF%E5%BE%91/)
- [composer 自动载入 autoload 的使用详解 psr0/psr4/classmap/files - big_cat - 开源中国](https://my.oschina.net/sallency/blog/893518)
- [php – Compoer – 非常簡單的使用 psr-4 來建立自動讀取類別 | jsnWork](http://jsnwork.kiiuo.com/archives/2618/php-compoer-%E9%9D%9E%E5%B8%B8%E7%B0%A1%E5%96%AE%E7%9A%84%E4%BD%BF%E7%94%A8-psr-4-%E4%BE%86%E5%BB%BA%E7%AB%8B%E8%87%AA%E5%8B%95%E8%AE%80%E5%8F%96%E9%A1%9E%E5%88%A5/)
- [php – composer.json 設定 classmap 指定自動讀取的檔案或路徑 | jsnWork](http://jsnwork.kiiuo.com/archives/2437/php-composer-json-%e8%a8%ad%e5%ae%9a-classmap-%e6%8c%87%e5%ae%9a%e8%87%aa%e5%8b%95%e8%ae%80%e5%8f%96%e7%9a%84%e6%aa%94%e6%a1%88%e6%88%96%e8%b7%af%e5%be%91/)
- [psr-0 和 psr-4 的区别 - shuizhuniurou - SegmentFault 思否](https://segmentfault.com/a/1190000006686978)
- [php - What Are the Differences Between PSR-0 and PSR-4? - Stack Overflow](https://stackoverflow.com/questions/24868586/what-are-the-differences-between-psr-0-and-psr-4)
- [PSR-0/PSR-4 命名标准 · php 笔记 · 看云](https://www.kancloud.cn/xiak/php-node/191121)
- [PHP PSR-4 与 PSR-0 规范 - zHHHe 的专栏 - CSDN 博客](https://blog.csdn.net/sky_zhe/article/details/38615615)
- [php 的 use 明顯比 require 高端大氣上檔次 - 開源中國](https://www.oschina.net/question/123890_135938?sort=default&p=2)
- [php 使用命名空间:导入导出之疑问 - 开源中国](https://www.oschina.net/question/147332_138188)
- [深入 Composer autoload | Laravel China 社区 - 高品质的 Laravel 和 PHP 开发者社区](https://laravel-china.org/topics/1002/deep-composer-autoload)
- [如何使用 Namespace? | 點燈坊](https://oomusou.io/php/php-namespace/)
- [PHP Tutorial: Getting Started with Composer | Codementor](https://www.codementor.io/jadjoubran/php-tutorial-getting-started-with-composer-8sbn6fb6t)
