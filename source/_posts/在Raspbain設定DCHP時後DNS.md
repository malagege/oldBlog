---
title: 在Raspbain設定DNS
date: 2018-04-19 20:54:30
tags: [Linux, Raspberry PI, DNS DHCP, resolvconf, Ubuntu]
categories: Linux
---
今天在鳥哥看到
> 例題：
我的主機使用 DHCP 取得 IP ，很奇怪的，當我修改過 /etc/resolv.conf 之後，隔不多久這個檔案又會恢復成原本的樣子，這是什麼原因？ 該如何處理？
答：
因為使用 DHCP 時，系統會主動的使用 DHCP 伺服器傳來的資料進行系統設定檔的修訂。因此，你必須告知系統，不要使用 DHCP 傳來的伺服器設定值。 此時，你得要在 /etc/sysconfig/network-scripts/ifcfg-eth0 等相關檔案內，增加一行：『PEERDNS=no』，然後重新啟動網路即可。
此外，如果你有啟動 CentOS 6.x 的 NetworkManager 服務，有時候也可能會產生一些奇特的現象哩！所以鳥哥是建議關掉它的！^_^ 

[鳥哥的 Linux 私房菜 -- DNS Server](http://linux.vbird.org/linux_server/0350dns.php#DNS_resolver_file)

很久之前我有寫過類似的問題
不過後來是用crontab來重覆寫這個問題
今天有看到一個方法

<!--more-->



>由於我用的是ubuntu, 沒有fedora的/etc/sysconfig/network-scripts/ifcfg-eth0 設定檔. 但是, 可以修改/etc/dhcp3/dhclient.conf來達到同樣的目的:

>$ sudo nano /etc/dhcp3/dhclient.conf
加入:
supersede domain-name-servers 168.95.1.1, 8.8.8.8;
supersede domain-name "domain1.com domain2.com";

>應該是跨發佈系統的.

[Linux DHCP DNS設定問題 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天](https://ithelp.ithome.com.tw/articles/10071258)

目前沒有試過這個東西

```
supersede domain-name-servers 8.8.8.8, 8.8.4.4;
```

[Ubuntu DNS 設定 @ Welkin小窩 :: 痞客邦 ::](http://welkinchen.pixnet.net/blog/post/5456817-ubuntu-dns-%E8%A8%AD%E5%AE%9A)
```
prepend domain-name-servers 8.8.8.8;
```

不過動物機還是不管用，但很多人好像都成功了
不知道為什麼


[networking - How to override the DHCP-provided nameserver? - Ask Ubuntu](https://askubuntu.com/questions/63160/how-to-override-the-dhcp-provided-nameserver)
```
A resolution that will resolve your problem is to configure your resolvconf package. This will give precedence to your preferred nameservers as well as any other desired settings resolv.conf settings such as search and domain preferences.

Edit the file: /etc/resolvconf/resolv.conf.d/head

Place your desired nameservers and any other configurations you want to take preference when there is a network change there. When any changes to the network happen, the configuration there will always take precedence.

An example of the /etc/resolvconf/resolv.conf.d/head file:

# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

nameserver 8.8.8.8
search mydomain.com

```


安裝resolvconf

照head設定dns
竟然成功了
先記錄

```text,/etc/resolv.conf
nameserver 8.8.8.8
nameserver 192.168.1.1
```

不過之前中華DNS好像有問題
最近又不會了...
可能正式機不會動


參考來源：
[鳥哥的 Linux 私房菜 -- DNS Server](http://linux.vbird.org/linux_server/0350dns.php#DNS_resolver_file)
[Linux DHCP DNS設定問題 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天](https://ithelp.ithome.com.tw/articles/10071258)
[Ubuntu DNS 設定 @ Welkin小窩 :: 痞客邦 ::](http://welkinchen.pixnet.net/blog/post/5456817-ubuntu-dns-%E8%A8%AD%E5%AE%9A)
[VPC DHCP类型的ECS修改DNS](https://zhuanlan.zhihu.com/p/34027883)
[networking - How to override the DHCP-provided nameserver? - Ask Ubuntu](https://askubuntu.com/questions/63160/how-to-override-the-dhcp-provided-nameserver)